<!DOCTYPE html>
<html>
<head>
  <title>Live Word Cloud (D3)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://d3js.org/d3.v6.min.js"></script>
  <script src="https://unpkg.com/d3-cloud/build/d3.layout.cloud.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #f0f7ff;
      font-family: 'Inter', sans-serif;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }

    #cloud {
      width: 100%;
      height: 100%;
    }

    text {
      font-family: 'Inter', sans-serif;
      cursor: default;
      transition: transform 0.3s ease;
    }
  </style>
</head>
<body>
  <svg id="cloud"></svg>

  <script>
    const socket = io();
    const wordCounts = {};

    const width = window.innerWidth;
    const height = window.innerHeight;
    const svg = d3.select("#cloud")
                  .attr("width", width)
                  .attr("height", height);
    const g = svg.append("g").attr("transform", `translate(${width / 2}, ${height / 2})`);

    function draw(words) {
      g.selectAll("text")
        .data(words, d => d.text)
        .join(
          enter => enter.append("text")
                        .text(d => d.text)
                        .attr("text-anchor", "middle")
                        .attr("font-size", d => d.size)
                        .style("fill", "#2e73f2")
                        .attr("transform", d => `translate(${d.x},${d.y})rotate(${d.rotate})`)
                        .style("opacity", 0)
                        .transition().duration(500)
                        .style("opacity", 1),
          update => update.transition().duration(500)
                          .attr("font-size", d => d.size)
                          .attr("transform", d => `translate(${d.x},${d.y})rotate(${d.rotate})`),
          exit => exit.transition().duration(300)
                      .style("opacity", 0)
                      .remove()
        );
    }

    function updateWordCloud(allWords) {
      allWords.forEach(word => {
        wordCounts[word] = (wordCounts[word] || 0) + 1;
      });

      const entries = Object.entries(wordCounts)
                            .map(([text, count]) => ({
                              text,
                              size: 12 + count * 10
                            }));

      d3.layout.cloud()
        .size([width, height])
        .words(entries)
        .padding(5)
        .rotate(() => ~~(Math.random() * 2) * 90)
        .font("Inter")
        .fontSize(d => d.size)
        .on("end", draw)
        .start();
    }

    socket.on("newWords", updateWordCloud);
  </script>
</body>
</html>




